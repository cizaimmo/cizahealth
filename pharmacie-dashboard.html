<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CizaHealth+ | Pharmacie partenaire</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">

<style>
:root{
  --blue:#123c8a;
  --bg:#f4f7fb;
  --card:#ffffff;
  --text:#0a1a2f;
  --muted:#6b7a90;
  --success:#2ecc71;
  --warning:#f39c12;
  --danger:#c0392b;
  --radius:22px;
}
*{box-sizing:border-box}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter;
  background:linear-gradient(180deg,#f4f7fb,#eef3fa);
  color:var(--text);
}

.app{
  max-width:1000px;
  margin:auto;
  min-height:100vh;
  background:#fff;
  box-shadow:0 12px 50px rgba(10,42,94,.08);
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  padding:18px 22px;
  background:linear-gradient(135deg,#123c8a,#1b4fa3);
  color:#fff;
}
header h1{
  margin:0;
  font-size:22px;
}
header p{
  margin:6px 0 0;
  font-size:13.5px;
  opacity:.95;
}

/* CONTENT */
.content{
  padding:26px;
}

/* CARD */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:22px;
  box-shadow:0 10px 28px rgba(10,42,94,.08);
  margin-bottom:22px;
}

/* TABLE */
.table{
  width:100%;
  border-collapse:collapse;
}
.table th{
  text-align:left;
  font-size:13px;
  color:var(--muted);
  padding-bottom:10px;
}
.table td{
  padding:14px 0;
  border-top:1px solid #eef1f6;
  font-size:14px;
}
.badge{
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:600;
}
.issued{background:#eef2ff;color:#2c3e8f}
.prepared{background:#fff3cd;color:#9c6500}
.delivered{background:#e8f8f1;color:#1e7e34}

/* BUTTONS */
.btn{
  border:none;
  border-radius:999px;
  padding:12px 18px;
  font-weight:600;
  cursor:pointer;
}
.primary{background:var(--blue);color:#fff}
.secondary{background:#eef2f8;color:var(--blue)}
.success{background:var(--success);color:#fff}
.warning{background:var(--warning);color:#fff}

/* FOOTER */
.footer{
  margin-top:auto;
  padding:20px;
  border-top:1px solid #eef1f6;
  text-align:center;
  font-size:12px;
  color:#8a95a8;
}
</style>
</head>

<body>
<div class="app">

<header>
  <h1>Pharmacie partenaire</h1>
  <p>Réception et gestion des ordonnances CizaHealth+</p>
</header>

<div class="content">

  <!-- INFO -->
  <div class="card">
    <strong>Instructions</strong>
    <p style="font-size:13.5px;color:var(--muted);line-height:1.6;margin-top:8px">
      Vérifiez l’identité du patient à l’aide du <strong>QR Code</strong> ou du
      <strong>code de prescription</strong>.  
      Le paiement est effectué directement entre le patient et la pharmacie.
    </p>
  </div>

  <!-- ORDONNANCES -->
  <div class="card">
    <h3 style="margin-top:0">Ordonnances reçues</h3>

    <table class="table">
      <thead>
        <tr>
          <th>Patient</th>
          <th>Médecin</th>
          <th>Date</th>
          <th>Statut</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="prescriptionList">
        <!-- Rempli dynamiquement -->
      </tbody>
    </table>
  </div>

</div>

<div class="footer">
  © 2026 CizaHealth+ — CIZA GROUP • Partenaires pharmaceutiques
</div>

</div>

<script type="module">
import { db } from "./firebase.js";
import {
  collection, query, orderBy, onSnapshot, updateDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const list = document.getElementById("prescriptionList");

const q = query(
  collection(db,"prescriptions"),
  orderBy("createdAt","desc")
);

onSnapshot(q,(snap)=>{
  list.innerHTML="";
  snap.forEach(d=>{
    const p=d.data();
    const tr=document.createElement("tr");

    tr.innerHTML=`
      <td>${p.patientName||"—"}</td>
      <td>${p.proName||"—"}</td>
      <td>${p.createdAt?.toDate().toLocaleDateString()||"—"}</td>
      <td>
        <span class="badge ${p.status}">
          ${p.status==="issued"?"Émise":
            p.status==="prepared"?"Préparée":
            "Remise"}
        </span>
      </td>
      <td>
        <button class="btn secondary" onclick="markPrepared('${d.id}')">
          Préparer
        </button>
      </td>
    `;
    list.appendChild(tr);
  });
});

window.markPrepared = async(id)=>{
  await updateDoc(doc(db,"prescriptions",id),{
    status:"prepared"
  });
};
</script>

</body>
</html>
