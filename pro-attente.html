<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged, signOut }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, getDoc }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const logoutBtn = document.getElementById("logoutBtn");

logoutBtn.onclick = async () => {
  await signOut(auth);
  location.href = "/cizahealth/pro-login.html";
};

onAuthStateChanged(auth, async (user)=>{
  if(!user){
    location.href="/cizahealth/pro-login.html";
    return;
  }

  const snap = await getDoc(doc(db,"professionals",user.uid));

  if(!snap.exists()){
    await signOut(auth);
    location.href="/cizahealth/pro-login.html";
    return;
  }

  if(snap.data().status === "validated"){
    location.href="/cizahealth/dashboard-pro.html";
  }
});
</script>
