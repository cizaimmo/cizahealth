<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CizaHealth+ | Compl√©ter mon profil</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --blue:#123c8a;
  --bg:#f4f7fb;
  --text:#0a1a2f;
  --muted:#6b7a90;
  --radius:22px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter;
  background:var(--bg);
  color:var(--text);
}
.app{
  max-width:430px;
  margin:auto;
  min-height:100vh;
  background:#fff;
  padding:24px;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
h1{
  text-align:center;
  font-size:20px;
  margin-bottom:10px;
}
p{
  text-align:center;
  font-size:13.5px;
  color:var(--muted);
  margin-bottom:24px;
}
label{
  display:block;
  margin-top:18px;
  font-weight:600;
  font-size:14px;
}
input, select{
  width:100%;
  margin-top:8px;
  padding:14px;
  border-radius:14px;
  border:1.5px solid #e6ebf5;
  font-size:14px;
}
button{
  margin-top:28px;
  width:100%;
  padding:16px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,#123c8a,#1b4fa3);
  color:#fff;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
}
button:disabled{
  opacity:.6;
  cursor:not-allowed;
}
.note{
  margin-top:18px;
  font-size:12.5px;
  text-align:center;
  color:var(--muted);
}
</style>
</head>

<body>
<div class="app">

  <h1>Compl√©ter mon profil</h1>
  <p>
    Ces informations sont n√©cessaires pour une prise en charge
    m√©dicale adapt√©e et s√©curis√©e.
  </p>

  <!-- √ÇGE -->
  <label>√Çge</label>
  <input id="age" type="number" min="0" max="120" placeholder="Ex : 35">

  <!-- GENRE -->
  <label>Genre</label>
  <select id="gender">
    <option value="">S√©lectionnez</option>
    <option value="homme">Homme</option>
    <option value="femme">Femme</option>
    <option value="autre">Autre / Pr√©f√®re ne pas dire</option>
  </select>

  <!-- PROVINCE -->
  <label>Province</label>
  <select id="province">
    <option value="">S√©lectionnez votre province</option>
    <option>Bujumbura Mairie</option>
    <option>Bujumbura Rural</option>
    <option>Gitega</option>
    <option>Ngozi</option>
    <option>Muyinga</option>
    <option>Makamba</option>
    <option>Bururi</option>
    <option>Rumonge</option>
    <option>Cibitoke</option>
    <option>Bubanza</option>
    <option>Kirundo</option>
    <option>Karuzi</option>
    <option>Kayanza</option>
    <option>Muramvya</option>
    <option>Rutana</option>
    <option>Ruyigi</option>
  </select>

  <button id="saveBtn">Enregistrer</button>

  <div class="note">
    Vos donn√©es sont confidentielles et prot√©g√©es.
  </div>

</div>

<!-- üîê FIREBASE ‚Äì UPDATE PROFIL -->
<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, updateDoc }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const btn = document.getElementById("saveBtn");

onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  }
});

btn.addEventListener("click", async () => {
  const age = parseInt(document.getElementById("age").value);
  const province = document.getElementById("province").value;
  const gender = document.getElementById("gender").value;

  if (!age || !province || !gender) {
    alert("Veuillez renseigner votre √¢ge, votre genre et votre province.");
    return;
  }

  btn.disabled = true;
  btn.innerText = "Enregistrement‚Ä¶";

  try {
    await updateDoc(doc(db,"patients",auth.currentUser.uid), {
      age,
      province,
      gender
    });

    alert("Profil mis √† jour avec succ√®s.");
    window.location.href = "dashboard-client.html";

  } catch (e) {
    console.error(e);
    alert("Erreur lors de la mise √† jour.");
    btn.disabled = false;
    btn.innerText = "Enregistrer";
  }
});
</script>

</body>
</html>
