<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>TEST ADMIN ‚Äì Lecture Firestore</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#f4f7fb;
  margin:0;
}
.app{
  max-width:800px;
  margin:auto;
  min-height:100vh;
  background:#fff;
  padding:24px;
}
.card{
  border:1.5px solid #e6ebf5;
  border-radius:12px;
  padding:14px;
  margin-bottom:12px;
}
.empty{
  text-align:center;
  opacity:.6;
  padding:40px;
}
.uid{font-size:12px;opacity:.6}
</style>
</head>
<body>

<div class="app">
  <h1>TEST ADMIN ‚Äì Users pending</h1>
  <p>Ce fichier sert UNIQUEMENT √† tester la lecture Firestore.</p>
  <div id="list">Chargement‚Ä¶</div>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  collection, query, where, getDocs
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const list = document.getElementById("list");

onAuthStateChanged(auth, async (user)=>{
  if(!user){
    list.innerHTML = "<div class='empty'>‚ùå Pas connect√©</div>";
    return;
  }

  list.innerHTML = "Lecture Firestore‚Ä¶";

  try{
    // üîç TEST SIMPLE ‚Äî 1 SEULE CONDITION
    const q = query(
      collection(db,"users"),
      where("status","==","pending")
    );

    const snap = await getDocs(q);

    list.innerHTML = "";

    if(snap.empty){
      list.innerHTML = "<div class='empty'>‚ö†Ô∏è Aucun user pending trouv√©</div>";
      return;
    }

    snap.forEach(d=>{
      const u = d.data();
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <b>${u.fullName || "‚Äî"}</b><br>
        ${u.email || ""}<br>
        role: <b>${u.role}</b><br>
        status: <b>${u.status}</b><br>
        <div class="uid">uid: ${d.id}</div>
      `;
      list.appendChild(div);
    });

  }catch(e){
    console.error(e);
    list.innerHTML = "<div class='empty'>‚ùå Erreur Firestore (voir console)</div>";
  }
});
</script>

</body>
</html>
